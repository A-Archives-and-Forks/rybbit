!function(){let t=document.currentScript,e=t.getAttribute("src").split("/script.js")[0];if(new Promise((t,e)=>{let r=document.createElement("script");r.src="https://unpkg.com/web-vitals@3/dist/web-vitals.iife.js",r.onload=()=>t(),r.onerror=()=>e(Error("Failed to load web-vitals library")),document.head.appendChild(r)}).then(()=>{T()}).catch(t=>{console.warn("Failed to load web vitals library:",t)}),null!==localStorage.getItem("disable-rybbit")){window.rybbit={pageview(){},event(){},trackOutbound(){},identify(){},clearUserId(){},getUserId:()=>null};return}if(!e){console.error("Please provide a valid analytics host");return}let r=t.getAttribute("data-site-id")||t.getAttribute("site-id");if(!r||isNaN(Number(r))){console.error("Please provide a valid site ID using the data-site-id attribute");return}let a=t.getAttribute("data-debounce")?Math.max(0,parseInt(t.getAttribute("data-debounce"))):500,n="false"!==t.getAttribute("data-auto-track-pageview"),i="false"!==t.getAttribute("data-track-spa"),l="false"!==t.getAttribute("data-track-query"),s="false"!==t.getAttribute("data-track-outbound"),u=[];try{let o=t.getAttribute("data-skip-patterns");o&&(u=JSON.parse(o),Array.isArray(u)||(u=[]))}catch(c){console.error("Error parsing data-skip-patterns:",c)}let d=[];try{let p=t.getAttribute("data-mask-patterns");p&&(d=JSON.parse(p),Array.isArray(d)||(d=[]))}catch(g){console.error("Error parsing data-mask-patterns:",g)}let f=null;try{let b=localStorage.getItem("rybbit-user-id");b&&(f=b)}catch(h){}function y(t){let e="__DOUBLE_ASTERISK_TOKEN__",r="__SINGLE_ASTERISK_TOKEN__",a=t.replace(/\*\*/g,e).replace(/\*/g,r).replace(/[.+?^${}()|[\]\\]/g,"\\$&"),n=(a=a.replace(/\//g,"\\/")).replace(RegExp(e,"g"),".*").replace(RegExp(r,"g"),"[^/]+");return RegExp("^"+n+"$")}function v(t,e){for(let r of e)try{let a=y(r);if(a.test(t))return r}catch(n){console.error(`Invalid pattern: ${r}`,n)}return null}let m=()=>{let t=new URL(window.location.href),e=t.pathname;if(t.hash&&t.hash.startsWith("#/")&&(e=t.hash.substring(1)),v(e,u))return null;let a=v(e,d);a&&(e=a);let n={site_id:r,hostname:t.hostname,pathname:e,querystring:l?t.search:"",screenWidth:window.innerWidth,screenHeight:window.innerHeight,language:navigator.language,page_title:document.title,referrer:document.referrer};return f&&(n.user_id=f),n},w=t=>{let r=JSON.stringify(t),a=`${e}/track`;if(navigator.sendBeacon){let n=navigator.sendBeacon(a,r);if(n)return}fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:r,mode:"cors",credentials:"include",keepalive:!0}).catch(console.error)},I=(t="pageview",e="",r={})=>{if("custom_event"===t&&(!e||"string"!=typeof e)){console.error("Event name is required and must be a string for custom events");return}let a=m();if(!a)return;let n={...a,type:t,event_name:e,properties:"custom_event"===t||"outbound"===t?JSON.stringify(r):void 0};w(n)},k={lcp:null,cls:null,inp:null,fcp:null,ttfb:null},A=!1,E=null,S=()=>{if(A)return;let t=Object.values(k).every(t=>null!==t);t&&$()},$=()=>{if(A)return;A=!0,E&&(clearTimeout(E),E=null);let t=m();if(!t)return;let e={...t,type:"performance",event_name:"web-vitals",lcp:k.lcp,cls:k.cls,inp:k.inp,fcp:k.fcp,ttfb:k.ttfb};w(e)},L=t=>{A||(k[t.name.toLowerCase()]=t.value,S())},T=()=>{if("undefined"!=typeof webVitals)try{webVitals.getLCP(L),webVitals.getCLS(L),webVitals.getINP(L),webVitals.getFCP(L),webVitals.getTTFB(L),E=setTimeout(()=>{A||$()},2e4),window.addEventListener("beforeunload",()=>{A||$()})}catch(t){console.warn("Error initializing web vitals tracking:",t)}},C=()=>I("pageview"),O=a>0?function t(e,r){let a;return(...t)=>{clearTimeout(a),a=setTimeout(()=>e.apply(this,t),r)}}(C,a):C;if(s&&document.addEventListener("click",function(t){let e=t.target.closest("a");e&&e.href&&function t(e){try{let r=window.location.hostname,a=new URL(e).hostname;return a!==r&&""!==a}catch(n){return!1}}(e.href)&&I("outbound","",{url:e.href,text:e.innerText||e.textContent||"",target:e.target||"_self"})}),i){let P=history.pushState,U=history.replaceState;history.pushState=function(...t){P.apply(this,t),O()},history.replaceState=function(...t){U.apply(this,t),O()},window.addEventListener("popstate",O),window.addEventListener("hashchange",O)}window.rybbit={pageview:C,event:(t,e={})=>I("custom_event",t,e),trackOutbound:(t,e="",r="_self")=>I("outbound","",{url:t,text:e,target:r}),identify(t){if("string"!=typeof t||""===t.trim()){console.error("User ID must be a non-empty string");return}f=t.trim();try{localStorage.setItem("rybbit-user-id",f)}catch(e){console.warn("Could not persist user ID to localStorage")}},clearUserId(){f=null;try{localStorage.removeItem("rybbit-user-id")}catch(t){}},getUserId:()=>f},n&&C()}();