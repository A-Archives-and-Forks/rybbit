"use strict";(()=>{var se=Object.defineProperty;var ae=(i,e,t)=>e in i?se(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var h=(i,e,t)=>ae(i,typeof e!="symbol"?e+"":e,t);function oe(i){let e="__DOUBLE_ASTERISK_TOKEN__",t="__SINGLE_ASTERISK_TOKEN__",r=i.replace(/\*\*/g,e).replace(/\*/g,t).replace(/[.+?^${}()|[\]\\]/g,"\\$&");r=r.replace(new RegExp(`/${e}/`,"g"),"/(?:.+/)?"),r=r.replace(new RegExp(e,"g"),".*"),r=r.replace(/\//g,"\\/");let c=r.replace(new RegExp(t,"g"),"[^/]+");return new RegExp("^"+c+"$")}function k(i,e){for(let t of e)try{if(oe(t).test(i))return t}catch(n){console.error(`Invalid pattern: ${t}`,n)}return null}function x(i,e){let t=null;return(...n)=>{t&&clearTimeout(t),t=setTimeout(()=>i(...n),e)}}function F(i){try{let e=window.location.hostname,t=new URL(i).hostname;return t!==e&&t!==""}catch{return!1}}function E(i,e){if(!i)return e;try{let t=JSON.parse(i);return Array.isArray(e)&&!Array.isArray(t)?e:t}catch(t){return console.error("Error parsing JSON:",t),e}}function W(i){let e=i.getAttribute("src");if(!e)return console.error("Script src attribute is missing"),null;let t=e.split("/script.js")[0];if(!t)return console.error("Please provide a valid analytics host"),null;let n=i.getAttribute("data-site-id")||i.getAttribute("site-id");if(!n||isNaN(Number(n)))return console.error("Please provide a valid site ID using the data-site-id attribute"),null;let r=i.getAttribute("data-debounce")?Math.max(0,parseInt(i.getAttribute("data-debounce"))):500,c=E(i.getAttribute("data-skip-patterns"),[]),a=E(i.getAttribute("data-mask-patterns"),[]),s=i.getAttribute("data-api-key")||void 0,o=i.getAttribute("data-replay-batch-size")?Math.max(1,parseInt(i.getAttribute("data-replay-batch-size"))):3,l=i.getAttribute("data-replay-batch-interval")?Math.max(1e3,parseInt(i.getAttribute("data-replay-batch-interval"))):2e3;return console.info(i),{analyticsHost:t,siteId:n,debounceDuration:r,autoTrackPageview:i.getAttribute("data-auto-track-pageview")!=="false",autoTrackSpa:i.getAttribute("data-track-spa")!=="false",trackQuerystring:i.getAttribute("data-track-query")!=="false",trackOutbound:i.getAttribute("data-track-outbound")!=="false",enableWebVitals:i.getAttribute("data-web-vitals")==="true",trackErrors:i.getAttribute("data-track-errors")==="true",enableSessionReplay:i.getAttribute("data-session-replay")==="true",sessionReplayBatchSize:o,sessionReplayBatchInterval:l,skipPatterns:c,maskPatterns:a,apiKey:s}}var y=class{constructor(e,t,n,r){this.isRecording=!1;this.eventBuffer=[];this.config=e,this.sessionId=t,this.userId=n,this.sendBatch=r}async initialize(){this.config.enableSessionReplay&&(window.rrweb||await this.loadRrweb(),window.rrweb?this.startRecording():console.warn("Failed to load rrweb, session replay disabled"))}async loadRrweb(){return new Promise((e,t)=>{let n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/rrweb@2.0.0-alpha.11/dist/rrweb.min.js",n.async=!1,n.onload=()=>{console.log("[Session Replay] rrweb loaded successfully"),e()},n.onerror=()=>t(new Error("Failed to load rrweb")),document.head.appendChild(n)})}startRecording(){if(this.isRecording||!window.rrweb||!this.config.enableSessionReplay){console.log("[Session Replay] Cannot start recording:",{isRecording:this.isRecording,hasRrweb:!!window.rrweb,enableSessionReplay:this.config.enableSessionReplay});return}console.log("[Session Replay] Starting recording at",new Date().toISOString()),console.log("[Session Replay] Document ready state:",document.readyState);try{this.stopRecordingFn=window.rrweb.record({emit:e=>{let n={0:"DOMContentLoaded",1:"Load",2:"FullSnapshot",3:"IncrementalSnapshot",4:"Meta",5:"Custom",6:"Plugin"}[e.type]||`Unknown(${e.type})`;console.log(`[Session Replay] Event collected: Type ${e.type} (${n}) at ${new Date(e.timestamp||Date.now()).toISOString()}`),this.addEvent({type:e.type,data:e.data,timestamp:e.timestamp||Date.now()})},recordCanvas:!0,collectFonts:!0,checkoutEveryNms:3e4,checkoutEveryNth:200,maskAllInputs:!0,maskInputOptions:{password:!0,email:!0},slimDOMOptions:{script:!1,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0},sampling:{mousemove:!1,mouseInteraction:!0,scroll:150,input:"last"}}),this.isRecording=!0,this.setupBatchTimer(),console.log("Session replay recording started")}catch(e){console.error("Failed to start session replay recording:",e)}}stopRecording(){this.isRecording&&(this.stopRecordingFn&&this.stopRecordingFn(),this.isRecording=!1,this.clearBatchTimer(),this.eventBuffer.length>0&&this.flushEvents(),console.log("Session replay recording stopped"))}isActive(){return this.isRecording}addEvent(e){this.eventBuffer.push(e),console.log(`[Session Replay] Event added to buffer (${this.eventBuffer.length}/${this.config.sessionReplayBatchSize})`),this.eventBuffer.length>=this.config.sessionReplayBatchSize&&(console.log(`[Session Replay] Buffer full, flushing ${this.eventBuffer.length} events`),this.flushEvents())}setupBatchTimer(){this.clearBatchTimer(),this.batchTimer=window.setInterval(()=>{this.eventBuffer.length>0&&(console.log(`[Session Replay] Timer triggered, flushing ${this.eventBuffer.length} events`),this.flushEvents())},this.config.sessionReplayBatchInterval)}clearBatchTimer(){this.batchTimer&&(clearInterval(this.batchTimer),this.batchTimer=void 0)}async flushEvents(){if(this.eventBuffer.length===0)return;let e=[...this.eventBuffer];this.eventBuffer=[],console.log(`[Session Replay] Sending batch with ${e.length} events to server`),console.log("[Session Replay] Event types in batch:",e.map(n=>`Type ${n.type}`).join(", ")),console.log("[Session Replay] Batch size:",JSON.stringify(e).length,"characters");let t={sessionId:this.sessionId,userId:this.userId,events:e,metadata:{pageUrl:window.location.href,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight}};try{await this.sendBatch(t),console.log(`[Session Replay] Successfully sent batch with ${e.length} events`)}catch(n){console.error("Failed to send session replay batch:",n),console.error("Failed batch details:",{eventCount:e.length,eventTypes:e.map(r=>r.type),batchSize:JSON.stringify(t).length,sessionId:this.sessionId,userId:this.userId,url:window.location.href}),console.log(`[Session Replay] Re-queuing ${e.length} failed events for retry`),this.eventBuffer.unshift(...e)}}updateSessionId(e){this.sessionId=e}updateUserId(e){this.userId=e}onPageChange(){this.isRecording&&this.flushEvents()}cleanup(){this.stopRecording()}};var v=class{constructor(e){this.customUserId=null;this.config=e,this.sessionId=this.generateSessionId(),this.loadUserId(),e.enableSessionReplay&&this.initializeSessionReplay()}loadUserId(){try{let e=localStorage.getItem("rybbit-user-id");e&&(this.customUserId=e)}catch{}}generateSessionId(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}async initializeSessionReplay(){try{this.sessionReplayRecorder=new y(this.config,this.sessionId,this.customUserId||this.generateUserId(),e=>this.sendSessionReplayBatch(e)),await this.sessionReplayRecorder.initialize()}catch(e){console.error("Failed to initialize session replay:",e)}}generateUserId(){return"anon_"+Math.random().toString(36).substring(2)+Date.now().toString(36)}async sendSessionReplayBatch(e){try{await fetch(`${this.config.analyticsHost}/session-replay/record/${this.config.siteId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),mode:"cors",keepalive:!1})}catch(t){throw console.error("Failed to send session replay batch:",t),t}}createBasePayload(){let e=new URL(window.location.href),t=e.pathname;if(e.hash&&e.hash.startsWith("#/")&&(t=e.hash.substring(1)),k(t,this.config.skipPatterns))return null;let n=k(t,this.config.maskPatterns);n&&(t=n);let r={site_id:this.config.siteId,hostname:e.hostname,pathname:t,querystring:this.config.trackQuerystring?e.search:"",screenWidth:window.innerWidth,screenHeight:window.innerHeight,language:navigator.language,page_title:document.title,referrer:document.referrer};return this.customUserId&&(r.user_id=this.customUserId),this.config.apiKey&&(r.api_key=this.config.apiKey),r}async sendTrackingData(e){try{await fetch(`${this.config.analyticsHost}/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),mode:"cors",keepalive:!0})}catch(t){console.error("Failed to send tracking data:",t)}}track(e,t="",n={}){if(e==="custom_event"&&(!t||typeof t!="string")){console.error("Event name is required and must be a string for custom events");return}let r=this.createBasePayload();if(!r)return;let c={...r,type:e,event_name:t,properties:e==="custom_event"||e==="outbound"||e==="error"?JSON.stringify(n):void 0};this.sendTrackingData(c)}trackPageview(){this.track("pageview")}trackEvent(e,t={}){this.track("custom_event",e,t)}trackOutbound(e,t="",n="_self"){this.track("outbound","",{url:e,text:t,target:n})}trackWebVitals(e){let t=this.createBasePayload();if(!t)return;let n={...t,type:"performance",event_name:"web-vitals",...e};this.sendTrackingData(n)}trackError(e,t={}){let n=window.location.origin,r=t.filename||"",c=e.stack||"";if(r)try{if(new URL(r).origin!==n)return}catch{}else if(c&&!c.includes(n))return;let a={message:e.message?.substring(0,500)||"Unknown error",stack:c.substring(0,2e3)||""};if(r&&(a.fileName=r),t.lineno){let s=typeof t.lineno=="string"?parseInt(t.lineno,10):t.lineno;s&&s!==0&&(a.lineNumber=s)}if(t.colno){let s=typeof t.colno=="string"?parseInt(t.colno,10):t.colno;s&&s!==0&&(a.columnNumber=s)}for(let s in t)!["lineno","colno"].includes(s)&&t[s]!==void 0&&(a[s]=t[s]);this.track("error",e.name||"Error",a)}identify(e){if(typeof e!="string"||e.trim()===""){console.error("User ID must be a non-empty string");return}this.customUserId=e.trim();try{localStorage.setItem("rybbit-user-id",this.customUserId)}catch{console.warn("Could not persist user ID to localStorage")}this.sessionReplayRecorder&&this.sessionReplayRecorder.updateUserId(this.customUserId)}clearUserId(){this.customUserId=null;try{localStorage.removeItem("rybbit-user-id")}catch{}}getUserId(){return this.customUserId}startSessionReplay(){this.sessionReplayRecorder?this.sessionReplayRecorder.startRecording():console.warn("Session replay not initialized")}stopSessionReplay(){this.sessionReplayRecorder&&this.sessionReplayRecorder.stopRecording()}isSessionReplayActive(){return this.sessionReplayRecorder?.isActive()??!1}onPageChange(){this.sessionReplayRecorder&&this.sessionReplayRecorder.onPageChange()}cleanup(){this.sessionReplayRecorder&&this.sessionReplayRecorder.cleanup()}};var Q=-1,g=i=>{addEventListener("pageshow",e=>{e.persisted&&(Q=e.timeStamp,i(e))},!0)},d=(i,e,t,n)=>{let r,c;return a=>{e.value>=0&&(a||n)&&(c=e.value-(r??0),(c||r===void 0)&&(r=e.value,e.delta=c,e.rating=((s,o)=>s>o[1]?"poor":s>o[0]?"needs-improvement":"good")(e.value,t),i(e)))}},M=i=>{requestAnimationFrame(()=>requestAnimationFrame(()=>i()))},O=()=>{let i=performance.getEntriesByType("navigation")[0];if(i&&i.responseStart>0&&i.responseStart<performance.now())return i},f=()=>O()?.activationStart??0,u=(i,e=-1)=>{let t=O(),n="navigate";return Q>=0?n="back-forward-cache":t&&(document.prerendering||f()>0?n="prerender":document.wasDiscarded?n="restore":t.type&&(n=t.type.replace(/_/g,"-"))),{name:i,value:e,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:n}},I=new WeakMap;function _(i,e){return I.get(i)||I.set(i,new e),I.get(i)}var C=class{constructor(){h(this,"t");h(this,"i",0);h(this,"o",[])}h(e){if(e.hadRecentInput)return;let t=this.o[0],n=this.o.at(-1);this.i&&t&&n&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(this.i+=e.value,this.o.push(e)):(this.i=e.value,this.o=[e]),this.t?.(e)}},m=(i,e,t={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(i)){let n=new PerformanceObserver(r=>{Promise.resolve().then(()=>{e(r.getEntries())})});return n.observe({type:i,buffered:!0,...t}),n}}catch{}},N=i=>{let e=!1;return()=>{e||(i(),e=!0)}},p=-1,$=()=>document.visibilityState!=="hidden"||document.prerendering?1/0:0,S=i=>{document.visibilityState==="hidden"&&p>-1&&(p=i.type==="visibilitychange"?i.timeStamp:0,ce())},H=()=>{addEventListener("visibilitychange",S,!0),addEventListener("prerenderingchange",S,!0)},ce=()=>{removeEventListener("visibilitychange",S,!0),removeEventListener("prerenderingchange",S,!0)},Y=()=>{if(p<0){let i=f();p=(document.prerendering?void 0:globalThis.performance.getEntriesByType("visibility-state").filter(t=>t.name==="hidden"&&t.startTime>i)[0]?.startTime)??$(),H(),g(()=>{setTimeout(()=>{p=$(),H()})})}return{get firstHiddenTime(){return p}}},R=i=>{document.prerendering?addEventListener("prerenderingchange",()=>i(),!0):i()},z=[1800,3e3],U=(i,e={})=>{R(()=>{let t=Y(),n,r=u("FCP"),c=m("paint",a=>{for(let s of a)s.name==="first-contentful-paint"&&(c.disconnect(),s.startTime<t.firstHiddenTime&&(r.value=Math.max(s.startTime-f(),0),r.entries.push(s),n(!0)))});c&&(n=d(i,r,z,e.reportAllChanges),g(a=>{r=u("FCP"),n=d(i,r,z,e.reportAllChanges),M(()=>{r.value=performance.now()-a.timeStamp,n(!0)})}))})},V=[.1,.25],X=(i,e={})=>{U(N(()=>{let t,n=u("CLS",0),r=_(e,C),c=s=>{for(let o of s)r.h(o);r.i>n.value&&(n.value=r.i,n.entries=r.o,t())},a=m("layout-shift",c);a&&(t=d(i,n,V,e.reportAllChanges),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(c(a.takeRecords()),t(!0))}),g(()=>{r.i=0,n=u("CLS",0),t=d(i,n,V,e.reportAllChanges),M(()=>t())}),setTimeout(t))}))},Z=0,P=1/0,b=0,le=i=>{for(let e of i)e.interactionId&&(P=Math.min(P,e.interactionId),b=Math.max(b,e.interactionId),Z=b?(b-P)/7+1:0)},B,J=()=>B?Z:performance.interactionCount??0,de=()=>{"interactionCount"in performance||B||(B=m("event",le,{type:"event",buffered:!0,durationThreshold:0}))},K=0,A=class{constructor(){h(this,"u",[]);h(this,"l",new Map);h(this,"m");h(this,"v")}p(){K=J(),this.u.length=0,this.l.clear()}P(){let e=Math.min(this.u.length-1,Math.floor((J()-K)/50));return this.u[e]}h(e){if(this.m?.(e),!e.interactionId&&e.entryType!=="first-input")return;let t=this.u.at(-1),n=this.l.get(e.interactionId);if(n||this.u.length<10||e.duration>t.T){if(n?e.duration>n.T?(n.entries=[e],n.T=e.duration):e.duration===n.T&&e.startTime===n.entries[0].startTime&&n.entries.push(e):(n={id:e.interactionId,entries:[e],T:e.duration},this.l.set(n.id,n),this.u.push(n)),this.u.sort((r,c)=>c.T-r.T),this.u.length>10){let r=this.u.splice(10);for(let c of r)this.l.delete(c.id)}this.v?.(n)}}},ee=i=>{let e=globalThis.requestIdleCallback||setTimeout;document.visibilityState==="hidden"?i():(i=N(i),document.addEventListener("visibilitychange",i,{once:!0}),e(()=>{i(),document.removeEventListener("visibilitychange",i)}))},j=[200,500],te=(i,e={})=>{globalThis.PerformanceEventTiming&&"interactionId"in PerformanceEventTiming.prototype&&R(()=>{de();let t,n=u("INP"),r=_(e,A),c=s=>{ee(()=>{for(let l of s)r.h(l);let o=r.P();o&&o.T!==n.value&&(n.value=o.T,n.entries=o.entries,t())})},a=m("event",c,{durationThreshold:e.durationThreshold??40});t=d(i,n,j,e.reportAllChanges),a&&(a.observe({type:"first-input",buffered:!0}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(c(a.takeRecords()),t(!0))}),g(()=>{r.p(),n=u("INP"),t=d(i,n,j,e.reportAllChanges)}))})},L=class{constructor(){h(this,"m")}h(e){this.m?.(e)}},q=[2500,4e3],ie=(i,e={})=>{R(()=>{let t=Y(),n,r=u("LCP"),c=_(e,L),a=o=>{e.reportAllChanges||(o=o.slice(-1));for(let l of o)c.h(l),l.startTime<t.firstHiddenTime&&(r.value=Math.max(l.startTime-f(),0),r.entries=[l],n())},s=m("largest-contentful-paint",a);if(s){n=d(i,r,q,e.reportAllChanges);let o=N(()=>{a(s.takeRecords()),s.disconnect(),n(!0)});for(let l of["keydown","click","visibilitychange"])addEventListener(l,()=>ee(o),{capture:!0,once:!0});g(l=>{r=u("LCP"),n=d(i,r,q,e.reportAllChanges),M(()=>{r.value=performance.now()-l.timeStamp,n(!0)})})}})},G=[800,1800],D=i=>{document.prerendering?R(()=>D(i)):document.readyState!=="complete"?addEventListener("load",()=>D(i),!0):setTimeout(i)},ne=(i,e={})=>{let t=u("TTFB"),n=d(i,t,G,e.reportAllChanges);D(()=>{let r=O();r&&(t.value=Math.max(r.responseStart-f(),0),t.entries=[r],n(!0),g(()=>{t=u("TTFB",0),n=d(i,t,G,e.reportAllChanges),n(!0)}))})};var w=class{constructor(e){this.data={lcp:null,cls:null,inp:null,fcp:null,ttfb:null};this.sent=!1;this.timeout=null;this.onReadyCallback=null;this.onReadyCallback=e}initialize(){try{ie(this.collectMetric.bind(this)),X(this.collectMetric.bind(this)),te(this.collectMetric.bind(this)),U(this.collectMetric.bind(this)),ne(this.collectMetric.bind(this)),this.timeout=setTimeout(()=>{this.sent||this.sendData()},2e4),window.addEventListener("beforeunload",()=>{this.sent||this.sendData()})}catch(e){console.warn("Error initializing web vitals tracking:",e)}}collectMetric(e){if(this.sent)return;let t=e.name.toLowerCase();this.data[t]=e.value,Object.values(this.data).every(r=>r!==null)&&this.sendData()}sendData(){this.sent||(this.sent=!0,this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.onReadyCallback&&this.onReadyCallback(this.data))}getData(){return{...this.data}}};(function(){let i=document.currentScript;if(!i){console.error("Could not find current script tag");return}if(window.__RYBBIT_OPTOUT__||localStorage.getItem("disable-rybbit")!==null){window.rybbit={pageview:()=>{},event:()=>{},trackOutbound:()=>{},identify:()=>{},clearUserId:()=>{},getUserId:()=>null,startSessionReplay:()=>{},stopSessionReplay:()=>{},isSessionReplayActive:()=>!1};return}let e=W(i);if(!e)return;let t=new v(e);e.enableWebVitals&&new w(s=>{t.trackWebVitals(s)}).initialize(),e.trackErrors&&(window.addEventListener("error",a=>{t.trackError(a.error||new Error(a.message),{filename:a.filename,lineno:a.lineno,colno:a.colno})}),window.addEventListener("unhandledrejection",a=>{let s=a.reason instanceof Error?a.reason:new Error(String(a.reason));t.trackError(s,{type:"unhandledrejection"})}));let n=()=>t.trackPageview(),r=e.debounceDuration>0?x(n,e.debounceDuration):n;function c(){if(document.addEventListener("click",function(a){let s=a.target;for(;s&&s!==document.documentElement;){if(s.hasAttribute("data-rybbit-event")){let o=s.getAttribute("data-rybbit-event");if(o){let l={};for(let T of s.attributes)if(T.name.startsWith("data-rybbit-prop-")){let re=T.name.replace("data-rybbit-prop-","");l[re]=T.value}t.trackEvent(o,l)}break}s=s.parentElement}if(e.trackOutbound){let o=a.target.closest("a");o?.href&&F(o.href)&&t.trackOutbound(o.href,o.innerText||o.textContent||"",o.target||"_self")}}),e.autoTrackSpa){let a=history.pushState,s=history.replaceState;history.pushState=function(...o){a.apply(this,o),r(),t.onPageChange()},history.replaceState=function(...o){s.apply(this,o),r(),t.onPageChange()},window.addEventListener("popstate",()=>{r(),t.onPageChange()}),window.addEventListener("hashchange",()=>{r(),t.onPageChange()})}}window.rybbit={pageview:()=>t.trackPageview(),event:(a,s={})=>t.trackEvent(a,s),trackOutbound:(a,s="",o="_self")=>t.trackOutbound(a,s,o),identify:a=>t.identify(a),clearUserId:()=>t.clearUserId(),getUserId:()=>t.getUserId(),startSessionReplay:()=>t.startSessionReplay(),stopSessionReplay:()=>t.stopSessionReplay(),isSessionReplayActive:()=>t.isSessionReplayActive()},c(),window.addEventListener("beforeunload",()=>{t.cleanup()}),e.autoTrackPageview&&t.trackPageview()})();})();
