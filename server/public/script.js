!function(){const e=document.currentScript,t=e.getAttribute("src").split("/script.js")[0];new Promise(((e,t)=>{const r=document.createElement("script");r.src="https://unpkg.com/web-vitals@3/dist/web-vitals.iife.js",r.onload=()=>e(),r.onerror=()=>t(new Error("Failed to load web-vitals library")),document.head.appendChild(r)})).then((()=>{k()})).catch((e=>{console.warn("Failed to load web vitals library:",e)}));const r="true"===e.getAttribute("data-enable-replay");if(console.log(`[REPLAY] Session replay enabled: ${r}`),r&&(console.log("[REPLAY] Loading rrweb library..."),new Promise(((e,t)=>{const r=document.createElement("script");r.src="https://cdn.jsdelivr.net/npm/rrweb@2.0.0-alpha.18/dist/rrweb.min.js",r.onload=()=>e(),r.onerror=()=>t(new Error("Failed to load rrweb library")),document.head.appendChild(r)})).then((()=>{console.log("[REPLAY] rrweb library loaded successfully"),O()})).catch((e=>{console.error("[REPLAY ERROR] Failed to load rrweb library:",e)}))),null!==localStorage.getItem("disable-rybbit"))return void(window.rybbit={pageview:()=>{},event:()=>{},trackOutbound:()=>{},identify:()=>{},clearUserId:()=>{},getUserId:()=>null});if(!t)return void console.error("Please provide a valid analytics host");const n=e.getAttribute("data-site-id")||e.getAttribute("site-id");if(!n||isNaN(Number(n)))return void console.error("Please provide a valid site ID using the data-site-id attribute");const o=e.getAttribute("data-debounce")?Math.max(0,parseInt(e.getAttribute("data-debounce"))):500,a="false"!==e.getAttribute("data-auto-track-pageview"),s="false"!==e.getAttribute("data-track-spa"),l="false"!==e.getAttribute("data-track-query"),i="false"!==e.getAttribute("data-track-outbound"),c=parseFloat(e.getAttribute("data-replay-sample-rate")||"1.0"),d=parseInt(e.getAttribute("data-replay-max-duration")||"300000"),u="false"!==e.getAttribute("data-replay-mask-inputs"),p=e.getAttribute("data-replay-mask-selectors")||"input[type='password'], input[type='email'], .sensitive, [data-sensitive]";console.log("[REPLAY] Configuration:",{sampleRate:c,maxDuration:d,maskInputs:u,maskSelectors:p});let g=[];try{const t=e.getAttribute("data-skip-patterns");t&&(g=JSON.parse(t),Array.isArray(g)||(g=[]))}catch(e){console.error("Error parsing data-skip-patterns:",e)}let b=[];try{const t=e.getAttribute("data-mask-patterns");t&&(b=JSON.parse(t),Array.isArray(b)||(b=[]))}catch(e){console.error("Error parsing data-mask-patterns:",e)}let y=null;try{const e=localStorage.getItem("rybbit-user-id");e&&(y=e)}catch(e){}let m=null,h=[],f=null,w=null,R=null;function A(e){const t="__DOUBLE_ASTERISK_TOKEN__",r="__SINGLE_ASTERISK_TOKEN__";let n=e.replace(/\*\*/g,t).replace(/\*/g,r).replace(/[.+?^${}()|[\]\\]/g,"\\$&");n=n.replace(/\//g,"\\/");let o=n.replace(new RegExp(t,"g"),".*").replace(new RegExp(r,"g"),"[^/]+");return new RegExp("^"+o+"$")}function v(e,t){for(const r of t)try{if(A(r).test(e))return r}catch(e){console.error(`Invalid pattern: ${r}`,e)}return null}const E=()=>{const e=new URL(window.location.href);let t=e.pathname;if(e.hash&&e.hash.startsWith("#/")&&(t=e.hash.substring(1)),v(t,g))return null;const r=v(t,b);r&&(t=r);const o={site_id:n,hostname:e.hostname,pathname:t,querystring:l?e.search:"",screenWidth:window.innerWidth,screenHeight:window.innerHeight,language:navigator.language,page_title:document.title,referrer:document.referrer};return y&&(o.user_id=y),o},P=e=>{fetch(`${t}/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),mode:"cors",keepalive:!0}).catch(console.error)},L=(e="pageview",t="",r={})=>{if("custom_event"===e&&(!t||"string"!=typeof t))return void console.error("Event name is required and must be a string for custom events");const n=E();if(!n)return;const o={...n,type:e,event_name:t,properties:"custom_event"===e||"outbound"===e?JSON.stringify(r):void 0};P(o)};let S={lcp:null,cls:null,inp:null,fcp:null,ttfb:null},I=!1,Y=null;const x=()=>{if(I)return;I=!0,Y&&(clearTimeout(Y),Y=null);const e=E();if(!e)return;const t={...e,type:"performance",event_name:"web-vitals",lcp:S.lcp,cls:S.cls,inp:S.inp,fcp:S.fcp,ttfb:S.ttfb};P(t)},$=e=>{I||(S[e.name.toLowerCase()]=e.value,(()=>{if(I)return;Object.values(S).every((e=>null!==e))&&x()})())},k=()=>{if("undefined"!=typeof webVitals)try{webVitals.getLCP($),webVitals.getCLS($),webVitals.getINP($),webVitals.getFCP($),webVitals.getTTFB($),Y=setTimeout((()=>{I||x()}),2e4),window.addEventListener("beforeunload",(()=>{I||x()}))}catch(e){console.warn("Error initializing web vitals tracking:",e)}},_=(e,r=!1)=>{if(!e.length)return void console.log("[REPLAY] sendReplayEvents called with empty events array");const o={site_id:n,session_id:f,events:e,is_complete:r,timestamp:(new Date).toISOString()};y&&(o.user_id=y);const a=JSON.stringify(o).length;console.log(`[REPLAY] Sending ${e.length} events (${a} bytes) to ${t}/replay/ingest, isComplete: ${r}`),fetch(`${t}/replay/ingest`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),mode:"cors",keepalive:!0}).then((t=>{t.ok?console.log(`[REPLAY] Successfully sent ${e.length} events`):console.error(`[REPLAY ERROR] Failed to send events - Status: ${t.status} ${t.statusText}`)})).catch((e=>{console.error("[REPLAY ERROR] Network error sending events:",e)}))},T=()=>{console.log("[REPLAY] Stopping replay recording"),m&&(console.log("[REPLAY] Calling rrweb recorder stop function"),m(),m=null),h.length>0&&(console.log(`[REPLAY] Sending final ${h.length} events before stopping`),_(h,!0),h=[]),R&&(clearTimeout(R),R=null,console.log("[REPLAY] Cleared batch timeout")),console.log("[REPLAY] Replay recording stopped")},O=()=>{if(console.log("[REPLAY] initSessionReplay() called"),"undefined"!=typeof rrweb)if((()=>{const e=Math.random(),t=e<c;return console.log(`[REPLAY] shouldStartReplay() called - random: ${e.toFixed(4)}, sampleRate: ${c}, result: ${t}`),t})())try{f=crypto.randomUUID?crypto.randomUUID():"xxxx-xxxx-4xxx-yxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),w=Date.now(),console.log(`[REPLAY] Generated session ID: ${f}, start time: ${new Date(w).toISOString()}`);const e=p.split(",").map((e=>e.trim())).filter(Boolean);console.log("[REPLAY] Parsed mask selectors:",e);const t={emit(e){console.log(`[REPLAY] Event emitted - type: ${e.type}, timestamp: ${e.timestamp}`),h.push(e),(()=>{if(h.length>=50){const e=h.splice(0,50);console.log(`[REPLAY] Batching ${e.length} events (batch size reached)`),_(e)}R&&clearTimeout(R),R=setTimeout((()=>{if(h.length>0){const e=h.splice(0);console.log(`[REPLAY] Batching ${e.length} events (timeout reached)`),_(e)}}),5e3)})()},maskAllInputs:u,maskTextSelector:e.join(","),maskInputSelector:u?"input":"",blockSelector:".rybbit-no-record, [data-rybbit-no-record]",sampling:{mousemove:!0,mouseInteraction:!0,scroll:150,input:"last"},recordCanvas:!1,collectFonts:!1};console.log("[REPLAY] Starting rrweb.record() with options:",t),m=rrweb.record(t),console.log("[REPLAY] rrweb recording started successfully"),setTimeout((()=>{console.log(`[REPLAY] Max duration (${d}ms) reached, stopping replay`),T()}),d),window.addEventListener("beforeunload",(()=>{console.log("[REPLAY] Page unloading, stopping replay"),T()})),window.addEventListener("pagehide",(()=>{console.log("[REPLAY] Page hiding, stopping replay"),T()}))}catch(e){console.error("[REPLAY ERROR] Error initializing session replay:",e)}else console.log("[REPLAY] Replay not started due to sample rate");else console.warn("[REPLAY WARNING] rrweb library not available")},N=()=>L("pageview"),C=o>0?function(e,t){let r;return(...n)=>{clearTimeout(r),r=setTimeout((()=>e.apply(this,n)),t)}}(N,o):N;if(i&&document.addEventListener("click",(function(e){const t=e.target.closest("a");t&&t.href&&function(e){try{const t=window.location.hostname,r=new URL(e).hostname;return r!==t&&""!==r}catch(e){return!1}}(t.href)&&L("outbound","",{url:t.href,text:t.innerText||t.textContent||"",target:t.target||"_self"})})),s){const e=history.pushState,t=history.replaceState;history.pushState=function(...t){e.apply(this,t),C()},history.replaceState=function(...e){t.apply(this,e),C()},window.addEventListener("popstate",C),window.addEventListener("hashchange",C)}window.rybbit={pageview:N,event:(e,t={})=>L("custom_event",e,t),trackOutbound:(e,t="",r="_self")=>L("outbound","",{url:e,text:t,target:r}),identify:e=>{if("string"==typeof e&&""!==e.trim()){y=e.trim();try{localStorage.setItem("rybbit-user-id",y)}catch(e){console.warn("Could not persist user ID to localStorage")}}else console.error("User ID must be a non-empty string")},clearUserId:()=>{y=null;try{localStorage.removeItem("rybbit-user-id")}catch(e){}},getUserId:()=>y,startReplay:()=>{console.log(`[REPLAY] Public API startReplay() called - enableSessionReplay: ${r}, rrweb available: ${"undefined"!=typeof rrweb}, recorder active: ${null!==m}`),r&&"undefined"!=typeof rrweb&&!m?O():console.warn("[REPLAY WARNING] Cannot start replay - conditions not met")},stopReplay:()=>{console.log("[REPLAY] Public API stopReplay() called"),T()},isReplayActive:()=>{const e=null!==m;return console.log(`[REPLAY] Public API isReplayActive() called - result: ${e}`),e},getReplaySessionId:()=>(console.log(`[REPLAY] Public API getReplaySessionId() called - result: ${f}`),f)},a&&N()}();