!function(){const e=document.currentScript,t=e.getAttribute("src").split("/script.js")[0];if(new Promise(((e,t)=>{const r=document.createElement("script");r.src="https://unpkg.com/web-vitals@3/dist/web-vitals.iife.js",r.onload=()=>e(),r.onerror=()=>t(new Error("Failed to load web-vitals library")),document.head.appendChild(r)})).then((()=>{y()})).catch((e=>{console.warn("Failed to load web vitals library:",e)})),null!==localStorage.getItem("disable-rybbit"))return void(window.rybbit={pageview:()=>{},event:()=>{},trackOutbound:()=>{},identify:()=>{},clearUserId:()=>{},getUserId:()=>null});if(!t)return void console.error("Please provide a valid analytics host");const r=e.getAttribute("data-site-id")||e.getAttribute("site-id");if(!r||isNaN(Number(r)))return void console.error("Please provide a valid site ID using the data-site-id attribute");const n=e.getAttribute("data-debounce")?Math.max(0,parseInt(e.getAttribute("data-debounce"))):500,a="false"!==e.getAttribute("data-auto-track-pageview"),i="false"!==e.getAttribute("data-track-spa"),o="false"!==e.getAttribute("data-track-query"),s="false"!==e.getAttribute("data-track-outbound");let c=[];try{const t=e.getAttribute("data-skip-patterns");t&&(c=JSON.parse(t),Array.isArray(c)||(c=[]))}catch(e){console.error("Error parsing data-skip-patterns:",e)}let l=[];try{const t=e.getAttribute("data-mask-patterns");t&&(l=JSON.parse(t),Array.isArray(l)||(l=[]))}catch(e){console.error("Error parsing data-mask-patterns:",e)}let u=null;try{const e=localStorage.getItem("rybbit-user-id");e&&(u=e)}catch(e){}function d(e){const t="__DOUBLE_ASTERISK_TOKEN__",r="__SINGLE_ASTERISK_TOKEN__";let n=e.replace(/\*\*/g,t).replace(/\*/g,r).replace(/[.+?^${}()|[\]\\]/g,"\\$&");n=n.replace(/\//g,"\\/");let a=n.replace(new RegExp(t,"g"),".*").replace(new RegExp(r,"g"),"[^/]+");return new RegExp("^"+a+"$")}function p(e,t){for(const r of t)try{if(d(r).test(e))return r}catch(e){console.error(`Invalid pattern: ${r}`,e)}return null}const g=(e="pageview",n="",a={})=>{if("custom_event"===e&&(!n||"string"!=typeof n))return void console.error("Event name is required and must be a string for custom events");const i=new URL(window.location.href);let s=i.pathname;if(i.hash&&i.hash.startsWith("#/")&&(s=i.hash.substring(1)),p(s,c))return;const d=p(s,l);d&&(s=d);const g={site_id:r,hostname:i.hostname,pathname:s,querystring:o?i.search:"",screenWidth:window.innerWidth,screenHeight:window.innerHeight,language:navigator.language,page_title:document.title,referrer:document.referrer,type:e,event_name:n,properties:"custom_event"===e||"outbound"===e?JSON.stringify(a):void 0};u&&(g.user_id=u),fetch(`${t}/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g),mode:"cors",keepalive:!0}).catch(console.error)};let h={lcp:null,cls:null,inp:null,fcp:null,ttfb:null},b=!1,f=null;const w=()=>{if(b)return;b=!0,f&&(clearTimeout(f),f=null);const e={site_id:r,hostname:window.location.hostname,pathname:window.location.pathname,querystring:o?window.location.search:"",screenWidth:window.innerWidth,screenHeight:window.innerHeight,language:navigator.language,page_title:document.title,referrer:document.referrer,type:"performance",event_name:"web-vitals",lcp:h.lcp,cls:h.cls,inp:h.inp,fcp:h.fcp,ttfb:h.ttfb};u&&(e.user_id=u),fetch(`${t}/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),mode:"cors",keepalive:!0}).catch(console.error)},m=e=>{b||(h[e.name.toLowerCase()]=e.value,(()=>{if(b)return;Object.values(h).every((e=>null!==e))&&w()})())},y=()=>{if("undefined"!=typeof webVitals)try{webVitals.getLCP(m),webVitals.getCLS(m),webVitals.getINP(m),webVitals.getFCP(m),webVitals.getTTFB(m),f=setTimeout((()=>{b||w()}),1e4),window.addEventListener("beforeunload",(()=>{b||w()}))}catch(e){console.warn("Error initializing web vitals tracking:",e)}},v=()=>g("pageview"),_=n>0?function(e,t){let r;return(...n)=>{clearTimeout(r),r=setTimeout((()=>e.apply(this,n)),t)}}(v,n):v;if(s&&document.addEventListener("click",(function(e){const t=e.target.closest("a");t&&t.href&&function(e){try{const t=window.location.hostname,r=new URL(e).hostname;return r!==t&&""!==r}catch(e){return!1}}(t.href)&&g("outbound","",{url:t.href,text:t.innerText||t.textContent||"",target:t.target||"_self"})})),i){const e=history.pushState,t=history.replaceState;history.pushState=function(...t){e.apply(this,t),_()},history.replaceState=function(...e){t.apply(this,e),_()},window.addEventListener("popstate",_),window.addEventListener("hashchange",_)}window.rybbit={pageview:v,event:(e,t={})=>g("custom_event",e,t),trackOutbound:(e,t="",r="_self")=>g("outbound","",{url:e,text:t,target:r}),identify:e=>{if("string"==typeof e&&""!==e.trim()){u=e.trim();try{localStorage.setItem("rybbit-user-id",u)}catch(e){console.warn("Could not persist user ID to localStorage")}}else console.error("User ID must be a non-empty string")},clearUserId:()=>{u=null;try{localStorage.removeItem("rybbit-user-id")}catch(e){}},getUserId:()=>u},a&&v()}();