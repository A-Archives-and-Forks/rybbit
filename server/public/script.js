!function(){const e=document.currentScript,t=e.getAttribute("src").split("/script.js")[0];new Promise(((e,t)=>{const r=document.createElement("script");r.src="https://unpkg.com/web-vitals@3/dist/web-vitals.iife.js",r.onload=()=>e(),r.onerror=()=>t(new Error("Failed to load web-vitals library")),document.head.appendChild(r)})).then((()=>{N()})).catch((e=>{console.warn("Failed to load web vitals library:",e)}));const r="true"===e.getAttribute("data-enable-replay");if(r&&new Promise(((e,t)=>{const r=document.createElement("script");r.src="https://cdn.jsdelivr.net/npm/rrweb@2.0.0-alpha.4/dist/rrweb.min.js",r.onload=()=>e(),r.onerror=()=>t(new Error("Failed to load rrweb library")),document.head.appendChild(r)})).then((()=>{R()})).catch((e=>{console.warn("Failed to load rrweb library:",e)})),null!==localStorage.getItem("disable-rybbit"))return void(window.rybbit={pageview:()=>{},event:()=>{},trackOutbound:()=>{},identify:()=>{},clearUserId:()=>{},getUserId:()=>null});if(!t)return void console.error("Please provide a valid analytics host");const n=e.getAttribute("data-site-id")||e.getAttribute("site-id");if(!n||isNaN(Number(n)))return void console.error("Please provide a valid site ID using the data-site-id attribute");const a=e.getAttribute("data-debounce")?Math.max(0,parseInt(e.getAttribute("data-debounce"))):500,i="false"!==e.getAttribute("data-auto-track-pageview"),o="false"!==e.getAttribute("data-track-spa"),s="false"!==e.getAttribute("data-track-query"),l="false"!==e.getAttribute("data-track-outbound"),c=parseFloat(e.getAttribute("data-replay-sample-rate")||"0.1"),u=parseInt(e.getAttribute("data-replay-max-duration")||"300000"),d="false"!==e.getAttribute("data-replay-mask-inputs"),p=e.getAttribute("data-replay-mask-selectors")||"input[type='password'], input[type='email'], .sensitive, [data-sensitive]";let g=[];try{const t=e.getAttribute("data-skip-patterns");t&&(g=JSON.parse(t),Array.isArray(g)||(g=[]))}catch(e){console.error("Error parsing data-skip-patterns:",e)}let b=[];try{const t=e.getAttribute("data-mask-patterns");t&&(b=JSON.parse(t),Array.isArray(b)||(b=[]))}catch(e){console.error("Error parsing data-mask-patterns:",e)}let m=null;try{const e=localStorage.getItem("rybbit-user-id");e&&(m=e)}catch(e){}let h=null,y=[],f=null,w=null,v=null;function S(e){const t="__DOUBLE_ASTERISK_TOKEN__",r="__SINGLE_ASTERISK_TOKEN__";let n=e.replace(/\*\*/g,t).replace(/\*/g,r).replace(/[.+?^${}()|[\]\\]/g,"\\$&");n=n.replace(/\//g,"\\/");let a=n.replace(new RegExp(t,"g"),".*").replace(new RegExp(r,"g"),"[^/]+");return new RegExp("^"+a+"$")}function x(e,t){for(const r of t)try{if(S(r).test(e))return r}catch(e){console.error(`Invalid pattern: ${r}`,e)}return null}const _=()=>{const e=new URL(window.location.href);let t=e.pathname;if(e.hash&&e.hash.startsWith("#/")&&(t=e.hash.substring(1)),x(t,g))return null;const r=x(t,b);r&&(t=r);const a={site_id:n,hostname:e.hostname,pathname:t,querystring:s?e.search:"",screenWidth:window.innerWidth,screenHeight:window.innerHeight,language:navigator.language,page_title:document.title,referrer:document.referrer};return m&&(a.user_id=m),a},I=e=>{fetch(`${t}/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),mode:"cors",keepalive:!0}).catch(console.error)},A=(e="pageview",t="",r={})=>{if("custom_event"===e&&(!t||"string"!=typeof t))return void console.error("Event name is required and must be a string for custom events");const n=_();if(!n)return;const a={...n,type:e,event_name:t,properties:"custom_event"===e||"outbound"===e?JSON.stringify(r):void 0};I(a)};let E={lcp:null,cls:null,inp:null,fcp:null,ttfb:null},k=!1,T=null;const O=()=>{if(k)return;k=!0,T&&(clearTimeout(T),T=null);const e=_();if(!e)return;const t={...e,type:"performance",event_name:"web-vitals",lcp:E.lcp,cls:E.cls,inp:E.inp,fcp:E.fcp,ttfb:E.ttfb};I(t)},L=e=>{k||(E[e.name.toLowerCase()]=e.value,(()=>{if(k)return;Object.values(E).every((e=>null!==e))&&O()})())},N=()=>{if("undefined"!=typeof webVitals)try{webVitals.getLCP(L),webVitals.getCLS(L),webVitals.getINP(L),webVitals.getFCP(L),webVitals.getTTFB(L),T=setTimeout((()=>{k||O()}),2e4),window.addEventListener("beforeunload",(()=>{k||O()}))}catch(e){console.warn("Error initializing web vitals tracking:",e)}},U=(e,r=!1)=>{if(!e.length)return;const a={site_id:n,session_id:f,events:e,is_complete:r,timestamp:(new Date).toISOString()};m&&(a.user_id=m),fetch(`${t}/api/replay/ingest`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),mode:"cors",keepalive:!0}).catch(console.error)},C=()=>{h&&(h(),h=null),y.length>0&&(U(y,!0),y=[]),v&&(clearTimeout(v),v=null)},R=()=>{if("undefined"!=typeof rrweb&&Math.random()<c)try{f=crypto.randomUUID?crypto.randomUUID():"xxxx-xxxx-4xxx-yxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),w=Date.now();const e=p.split(",").map((e=>e.trim())).filter(Boolean);h=rrweb.record({emit(e){y.push(e),(()=>{if(y.length>=50){const e=y.splice(0,50);U(e)}v&&clearTimeout(v),v=setTimeout((()=>{if(y.length>0){const e=y.splice(0);U(e)}}),5e3)})()},maskAllInputs:d,maskTextSelector:e.join(","),maskInputSelector:d?"input":"",blockSelector:".rybbit-no-record, [data-rybbit-no-record]",sampling:{mousemove:!0,mouseInteraction:!0,scroll:150,input:"last"},recordCanvas:!1,collectFonts:!1}),setTimeout((()=>{C()}),u),window.addEventListener("beforeunload",C),window.addEventListener("pagehide",C)}catch(e){console.warn("Error initializing session replay:",e)}},P=()=>A("pageview"),j=a>0?function(e,t){let r;return(...n)=>{clearTimeout(r),r=setTimeout((()=>e.apply(this,n)),t)}}(P,a):P;if(l&&document.addEventListener("click",(function(e){const t=e.target.closest("a");t&&t.href&&function(e){try{const t=window.location.hostname,r=new URL(e).hostname;return r!==t&&""!==r}catch(e){return!1}}(t.href)&&A("outbound","",{url:t.href,text:t.innerText||t.textContent||"",target:t.target||"_self"})})),o){const e=history.pushState,t=history.replaceState;history.pushState=function(...t){e.apply(this,t),j()},history.replaceState=function(...e){t.apply(this,e),j()},window.addEventListener("popstate",j),window.addEventListener("hashchange",j)}window.rybbit={pageview:P,event:(e,t={})=>A("custom_event",e,t),trackOutbound:(e,t="",r="_self")=>A("outbound","",{url:e,text:t,target:r}),identify:e=>{if("string"==typeof e&&""!==e.trim()){m=e.trim();try{localStorage.setItem("rybbit-user-id",m)}catch(e){console.warn("Could not persist user ID to localStorage")}}else console.error("User ID must be a non-empty string")},clearUserId:()=>{m=null;try{localStorage.removeItem("rybbit-user-id")}catch(e){}},getUserId:()=>m,startReplay:()=>{r&&"undefined"!=typeof rrweb&&!h&&R()},stopReplay:()=>{C()},isReplayActive:()=>null!==h,getReplaySessionId:()=>f},i&&P()}();