(function(){"use strict";var I,N=-1,b=function(e){addEventListener("pageshow",function(t){t.persisted&&(N=t.timeStamp,e(t))},!0)},P=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},E=function(){var e=P();return e&&e.activationStart||0},h=function(e,t){var n=P(),i="navigate";return N>=0?i="back-forward-cache":n&&(document.prerendering||E()>0?i="prerender":document.wasDiscarded?i="restore":n.type&&(i=n.type.replace(/_/g,"-"))),{name:e,value:t===void 0?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:i}},T=function(e,t,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var i=new PerformanceObserver(function(r){Promise.resolve().then(function(){t(r.getEntries())})});return i.observe(Object.assign({type:e,buffered:!0},n||{})),i}}catch{}},m=function(e,t,n,i){var r,o;return function(d){t.value>=0&&(d||i)&&((o=t.value-(r||0))||r===void 0)&&(r=t.value,t.delta=o,t.rating=function(f,u){return f>u[1]?"poor":f>u[0]?"needs-improvement":"good"}(t.value,n),e(t))}},C=function(e){requestAnimationFrame(function(){return requestAnimationFrame(function(){return e()})})},L=function(e){var t=function(n){n.type!=="pagehide"&&document.visibilityState!=="hidden"||e(n)};addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0)},x=function(e){var t=!1;return function(n){t||(e(n),t=!0)}},w=-1,D=function(){return document.visibilityState!=="hidden"||document.prerendering?1/0:0},S=function(e){document.visibilityState==="hidden"&&w>-1&&(w=e.type==="visibilitychange"?e.timeStamp:0,Z())},U=function(){addEventListener("visibilitychange",S,!0),addEventListener("prerenderingchange",S,!0)},Z=function(){removeEventListener("visibilitychange",S,!0),removeEventListener("prerenderingchange",S,!0)},H=function(){return w<0&&(w=D(),U(),b(function(){setTimeout(function(){w=D(),U()},0)})),{get firstHiddenTime(){return w}}},k=function(e){document.prerendering?addEventListener("prerenderingchange",function(){return e()},!0):e()},B=[1800,3e3],W=function(e,t){t=t||{},k(function(){var n,i=H(),r=h("FCP"),o=T("paint",function(d){d.forEach(function(f){f.name==="first-contentful-paint"&&(o.disconnect(),f.startTime<i.firstHiddenTime&&(r.value=Math.max(f.startTime-E(),0),r.entries.push(f),n(!0)))})});o&&(n=m(e,r,B,t.reportAllChanges),b(function(d){r=h("FCP"),n=m(e,r,B,t.reportAllChanges),C(function(){r.value=performance.now()-d.timeStamp,n(!0)})}))})},K=[.1,.25],tt=function(e,t){t=t||{},W(x(function(){var n,i=h("CLS",0),r=0,o=[],d=function(u){u.forEach(function(l){if(!l.hadRecentInput){var p=o[0],v=o[o.length-1];r&&l.startTime-v.startTime<1e3&&l.startTime-p.startTime<5e3?(r+=l.value,o.push(l)):(r=l.value,o=[l])}}),r>i.value&&(i.value=r,i.entries=o,n())},f=T("layout-shift",d);f&&(n=m(e,i,K,t.reportAllChanges),L(function(){d(f.takeRecords()),n(!0)}),b(function(){r=0,i=h("CLS",0),n=m(e,i,K,t.reportAllChanges),C(function(){return n()})}),setTimeout(n,0))}))},q=0,M=1/0,A=0,et=function(e){e.forEach(function(t){t.interactionId&&(M=Math.min(M,t.interactionId),A=Math.max(A,t.interactionId),q=A?(A-M)/7+1:0)})},F=function(){return I?q:performance.interactionCount||0},nt=function(){"interactionCount"in performance||I||(I=T("event",et,{type:"event",buffered:!0,durationThreshold:0}))},J=[200,500],$=0,j=function(){return F()-$},g=[],O={},z=function(e){var t=g[g.length-1],n=O[e.interactionId];if(n||g.length<10||e.duration>t.latency){if(n)n.entries.push(e),n.latency=Math.max(n.latency,e.duration);else{var i={id:e.interactionId,latency:e.duration,entries:[e]};O[i.id]=i,g.push(i)}g.sort(function(r,o){return o.latency-r.latency}),g.splice(10).forEach(function(r){delete O[r.id]})}},rt=function(e,t){t=t||{},k(function(){var n;nt();var i,r=h("INP"),o=function(f){f.forEach(function(p){p.interactionId&&z(p),p.entryType==="first-input"&&!g.some(function(v){return v.entries.some(function(_){return p.duration===_.duration&&p.startTime===_.startTime})})&&z(p)});var u,l=(u=Math.min(g.length-1,Math.floor(j()/50)),g[u]);l&&l.latency!==r.value&&(r.value=l.latency,r.entries=l.entries,i())},d=T("event",o,{durationThreshold:(n=t.durationThreshold)!==null&&n!==void 0?n:40});i=m(e,r,J,t.reportAllChanges),d&&("PerformanceEventTiming"in window&&"interactionId"in PerformanceEventTiming.prototype&&d.observe({type:"first-input",buffered:!0}),L(function(){o(d.takeRecords()),r.value<0&&j()>0&&(r.value=0,r.entries=[]),i(!0)}),b(function(){g=[],$=F(),r=h("INP"),i=m(e,r,J,t.reportAllChanges)}))})},G=[2500,4e3],R={},it=function(e,t){t=t||{},k(function(){var n,i=H(),r=h("LCP"),o=function(u){var l=u[u.length-1];l&&l.startTime<i.firstHiddenTime&&(r.value=Math.max(l.startTime-E(),0),r.entries=[l],n())},d=T("largest-contentful-paint",o);if(d){n=m(e,r,G,t.reportAllChanges);var f=x(function(){R[r.id]||(o(d.takeRecords()),d.disconnect(),R[r.id]=!0,n(!0))});["keydown","click"].forEach(function(u){addEventListener(u,function(){return setTimeout(f,0)},!0)}),L(f),b(function(u){r=h("LCP"),n=m(e,r,G,t.reportAllChanges),C(function(){r.value=performance.now()-u.timeStamp,R[r.id]=!0,n(!0)})})}})},V=[800,1800],at=function e(t){document.prerendering?k(function(){return e(t)}):document.readyState!=="complete"?addEventListener("load",function(){return e(t)},!0):setTimeout(t,0)},ot=function(e,t){t=t||{};var n=h("TTFB"),i=m(e,n,V,t.reportAllChanges);at(function(){var r=P();if(r){var o=r.responseStart;if(o<=0||o>performance.now())return;n.value=Math.max(o-E(),0),n.entries=[r],i(!0),b(function(){n=h("TTFB",0),(i=m(e,n,V,t.reportAllChanges))(!0)})}})};class st{constructor(t){this.data={lcp:null,cls:null,inp:null,fcp:null,ttfb:null},this.sent=!1,this.timeout=null,this.onSend=t}init(){if(!this.sent)try{it(this.collectMetric.bind(this)),tt(this.collectMetric.bind(this)),rt(this.collectMetric.bind(this)),W(this.collectMetric.bind(this)),ot(this.collectMetric.bind(this)),this.timeout=setTimeout(()=>{this.sent||this.sendMetrics()},2e4),window.addEventListener("beforeunload",()=>{this.sent||this.sendMetrics()})}catch(t){console.warn("Error initializing web vitals tracking:",t)}}collectMetric(t){if(this.sent)return;const n=t.name.toLowerCase();this.data[n]=t.value,this.checkAndSendMetrics()}checkAndSendMetrics(){if(this.sent)return;Object.values(this.data).every(n=>n!==null)&&this.sendMetrics()}sendMetrics(){if(this.sent)return;this.sent=!0,this.timeout&&(clearTimeout(this.timeout),this.timeout=null);const t={type:"performance",event_name:"web-vitals",lcp:this.data.lcp,cls:this.data.cls,inp:this.data.inp,fcp:this.data.fcp,ttfb:this.data.ttfb};this.onSend(t)}getData(){return{...this.data}}isSent(){return this.sent}reset(){this.data={lcp:null,cls:null,inp:null,fcp:null,ttfb:null},this.sent=!1,this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}}function ct(e){const t="__DOUBLE_ASTERISK_TOKEN__",n="__SINGLE_ASTERISK_TOKEN__";let r=e.replace(/\*\*/g,t).replace(/\*/g,n).replace(/[.+?^${}()|[\]\\]/g,"\\$&");r=r.replace(/\//g,"\\/");let o=r.replace(new RegExp(t,"g"),".*").replace(new RegExp(n,"g"),"[^/]+");return new RegExp("^"+o+"$")}function Q(e,t){for(const n of t)try{if(ct(n).test(e))return n}catch(i){console.error(`Invalid pattern: ${n}`,i)}return null}function ut(e,t){let n;return function(...i){clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function lt(e){try{const t=window.location.hostname,n=new URL(e).hostname;return n!==t&&n!==""}catch{return!1}}function Y(e,t){if(!e)return t;try{const n=JSON.parse(e);return Array.isArray(t)&&Array.isArray(n)?n:t}catch(n){return console.error("Error parsing JSON:",n),t}}function dt(e){const t={};for(const n of e.attributes)if(n.name.startsWith("data-rybbit-prop-")){const i=n.name.replace("data-rybbit-prop-","");t[i]=n.value}return t}const ft=dt;function X(e){try{return localStorage.getItem(e)}catch{return null}}function pt(e,t){try{localStorage.setItem(e,t)}catch(n){console.warn("Could not persist to localStorage:",n)}}function ht(e){try{localStorage.removeItem(e)}catch{}}(function(){const e=document.currentScript;if(!e){console.error("Rybbit Analytics: Could not find script tag");return}const t=e.getAttribute("src")?.split("/script.js")[0];if(window.__RYBBIT_OPTOUT__||X("disable-rybbit")!==null){window.rybbit={pageview:()=>{},event:()=>{},trackOutbound:()=>{},identify:()=>{},clearUserId:()=>{},getUserId:()=>null};return}if(!t){console.error("Please provide a valid analytics host");return}const n=e.getAttribute("data-site-id")||e.getAttribute("site-id");if(!n||isNaN(Number(n))){console.error("Please provide a valid site ID using the data-site-id attribute");return}const i={siteId:n,analyticsHost:t,debounceDuration:e.getAttribute("data-debounce")?Math.max(0,parseInt(e.getAttribute("data-debounce")||"0")):500,autoTrackPageview:e.getAttribute("data-auto-track-pageview")!=="false",autoTrackSpa:e.getAttribute("data-track-spa")!=="false",trackQuerystring:e.getAttribute("data-track-query")!=="false",trackOutbound:e.getAttribute("data-track-outbound")!=="false",enableWebVitals:!0,skipPatterns:[],maskPatterns:[]};try{const a=e.getAttribute("data-skip-patterns");if(a){const s=Y(a,[]);Array.isArray(s)&&(i.skipPatterns=s)}}catch(a){console.error("Error parsing data-skip-patterns:",a)}try{const a=e.getAttribute("data-mask-patterns");if(a){const s=Y(a,[]);Array.isArray(s)&&(i.maskPatterns=s)}}catch(a){console.error("Error parsing data-mask-patterns:",a)}let r=null;const o=X("rybbit-user-id");o&&(r=o);const d=()=>{const a=new URL(window.location.href);let s=a.pathname;if(a.hash&&a.hash.startsWith("#/")&&(s=a.hash.substring(1)),Q(s,i.skipPatterns))return null;const c=Q(s,i.maskPatterns);c&&(s=c);const y={site_id:i.siteId,hostname:a.hostname,pathname:s,querystring:i.trackQuerystring?a.search:"",screenWidth:window.innerWidth,screenHeight:window.innerHeight,language:navigator.language,page_title:document.title,referrer:document.referrer,type:"pageview"};return r&&(y.user_id=r),y},f=a=>{fetch(`${i.analyticsHost}/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),mode:"cors",keepalive:!0}).catch(console.error)},u=(a="pageview",s="",c={})=>{if(a==="custom_event"&&(!s||typeof s!="string")){console.error("Event name is required and must be a string for custom events");return}const y=d();if(!y)return;const mt={...y,type:a,event_name:s,properties:a==="custom_event"||a==="outbound"?JSON.stringify(c):void 0};f(mt)};let l=null;l=new st(f),l.init();const p=()=>u("pageview"),v=i.debounceDuration>0?ut(p,i.debounceDuration):p;if(document.addEventListener("click",function(a){let s=a.target;for(;s&&s!==document.documentElement;){if(s.hasAttribute("data-rybbit-event")){const c=s.getAttribute("data-rybbit-event");if(c){const y=ft(s);u("custom_event",c,y)}break}s=s.parentElement}if(i.trackOutbound){const c=a.target.closest("a");if(!c||!c.href)return;lt(c.href)&&u("outbound","",{url:c.href,text:c.innerText||c.textContent||"",target:c.target||"_self"})}}),i.autoTrackSpa){const a=history.pushState,s=history.replaceState;history.pushState=function(...c){a.apply(this,c),v()},history.replaceState=function(...c){s.apply(this,c),v()},window.addEventListener("popstate",v),window.addEventListener("hashchange",v)}const _={pageview:p,event:(a,s={})=>u("custom_event",a,s),trackOutbound:(a,s="",c="_self")=>u("outbound","",{url:a,text:s,target:c}),identify:a=>{if(typeof a!="string"||a.trim()===""){console.error("User ID must be a non-empty string");return}r=a.trim(),pt("rybbit-user-id",r)},clearUserId:()=>{r=null,ht("rybbit-user-id")},getUserId:()=>r};window.rybbit=_,i.autoTrackPageview&&p()})()})();
