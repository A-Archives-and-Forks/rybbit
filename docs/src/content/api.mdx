import { Steps } from 'nextra/components'
import { Callout } from 'nextra/components'
import { Tabs } from 'nextra/components'

# API

Track events from server-side applications, mobile apps, or any platform using the HTTP API with authentication.

## Overview

The `/api/track` endpoint accepts tracking requests with API key authentication, bypassing domain validation. This enables server-side tracking, mobile app analytics, and programmatic event collection.

## Authentication

<Steps>
### Generate API Key

In your site dashboard: Settings → API Key tab → Generate API Key

### Include in Requests

Add the `api_key` field to your request payload:

```json
{
  "api_key": "rb_your_api_key_here",
  "site_id": "123",
  "type": "pageview",
  "pathname": "/page"
}
```

</Steps>

## Tracking Events

### Pageview Tracking

```bash
curl -X POST 'https://app.rybbit.io/api/track' \
  -H 'Content-Type: application/json' \
  -d '{
    "api_key": "rb_your_api_key_here",
    "site_id": "123",
    "type": "pageview",
    "pathname": "/api/users",
    "hostname": "api.example.com",
    "page_title": "User API Endpoint",
    "ip_address": "192.168.1.1"
  }'
```

### Custom Events

```bash
curl -X POST 'https://app.rybbit.io/api/track' \
  -H 'Content-Type: application/json' \
  -d '{
    "api_key": "rb_your_api_key_here",
    "site_id": "123",
    "type": "custom_event",
    "pathname": "/checkout",
    "event_name": "purchase",
    "properties": "{\"amount\": 99.99, \"currency\": \"USD\", \"product_id\": \"abc123\"}"
  }'
```


## Parameters

### Required
- `api_key` - Your generated API key (starts with `rb_`)
- `site_id` - Your site ID (string)
- `type` - Event type: `pageview` or `custom_event`
- `pathname` - Page path (string)

### Optional
- `hostname` - Domain name
- `page_title` - Page title (max 512 chars)
- `referrer` - Referrer URL (max 2048 chars)
- `user_id` - Custom user identifier (max 255 chars)
- `ip_address` - Custom IP for geolocation
- `querystring` - Query parameters
- `language` - Language code (e.g., "en")
- `screenWidth` - Screen width in pixels
- `screenHeight` - Screen height in pixels

### Custom Events Only
- `event_name` - Event name (required for custom events, max 256 chars)
- `properties` - JSON string with event data (max 2048 chars)

## Language Examples

<Tabs items={['Node.js', 'Python', 'Go']}>
  <Tabs.Tab>
```javascript
const trackEvent = async (eventData) => {
  const response = await fetch('https://app.rybbit.io/api/track', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      api_key: process.env.RYBBIT_API_KEY,
      site_id: process.env.RYBBIT_SITE_ID,
      ...eventData
    })
  });
  
  return response.json();
};

// Track a pageview
await trackEvent({
  type: 'pageview',
  pathname: '/api/users',
  hostname: 'api.example.com'
});

// Track a custom event
await trackEvent({
  type: 'custom_event',
  pathname: '/checkout',
  event_name: 'purchase',
  properties: JSON.stringify({ amount: 99.99, currency: 'USD' })
});
```

  </Tabs.Tab>
  <Tabs.Tab>
```python
import requests
import json
import os

def track_event(event_data):
    response = requests.post(
        'https://app.rybbit.io/api/track',
        headers={'Content-Type': 'application/json'},
        json={
            'api_key': os.getenv('RYBBIT_API_KEY'),
            'site_id': os.getenv('RYBBIT_SITE_ID'),
            **event_data
        }
    )
    return response.json()

# Track a pageview
track_event({
    'type': 'pageview',
    'pathname': '/api/users',
    'hostname': 'api.example.com'
})

# Track a custom event
track_event({
    'type': 'custom_event',
    'pathname': '/checkout',
    'event_name': 'purchase',
    'properties': json.dumps({'amount': 99.99, 'currency': 'USD'})
})
```
  </Tabs.Tab>
  <Tabs.Tab>

```go
package main

import (
    "bytes"
    "encoding/json"
    "net/http"
    "os"
)

type TrackingEvent struct {
    APIKey     string `json:"api_key"`
    SiteID     string `json:"site_id"`
    Type       string `json:"type"`
    Pathname   string `json:"pathname"`
    Hostname   string `json:"hostname,omitempty"`
    EventName  string `json:"event_name,omitempty"`
    Properties string `json:"properties,omitempty"`
}

func trackEvent(event TrackingEvent) error {
    event.APIKey = os.Getenv("RYBBIT_API_KEY")
    event.SiteID = os.Getenv("RYBBIT_SITE_ID")
    
    jsonData, err := json.Marshal(event)
    if err != nil {
        return err
    }
    
    resp, err := http.Post(
        "https://app.rybbit.io/api/track",
        "application/json",
        bytes.NewBuffer(jsonData),
    )
    if err != nil {
        return err
    }
    defer resp.Body.Close()
    
    return nil
}

func main() {
    // Track a pageview
    trackEvent(TrackingEvent{
        Type:     "pageview",
        Pathname: "/api/users",
        Hostname: "api.example.com",
    })
    
    // Track a custom event
    trackEvent(TrackingEvent{
        Type:       "custom_event",
        Pathname:   "/checkout",
        EventName:  "purchase",
        Properties: `{"amount": 99.99, "currency": "USD"}`,
    })
}
```
  </Tabs.Tab>
</Tabs>


## Response Format

### Success Response
```json
{
  "success": true
}
```

### Error Response
```json
{
  "success": false,
  "error": "Invalid API key",
  "details": {
    "fieldErrors": {},
    "formErrors": ["Custom events require event_name"]
  }
}
```

## Best Practices

<Callout type="info">
**Environment Variables**: Store your API key and site ID as environment variables to keep them secure.
</Callout>

<Callout type="warning">
**Rate Limiting**: The API doesn't enforce rate limits, but avoid sending excessive requests to maintain performance.
</Callout>

<Callout type="error">
**API Key Security**: Never expose API keys in client-side code or public repositories.
</Callout>

## Error Handling

Common error scenarios:
- **Invalid API key**: Check that your API key starts with `rb_` and hasn't been revoked
- **Site not found**: Verify your site ID is correct
- **Invalid payload**: Ensure required fields are present and data types match
- **JSON parsing errors**: For custom events, ensure properties field contains valid JSON

## Mobile App Integration

For mobile apps, track user sessions and key events:

```javascript
// Track app launch
trackEvent({
  type: 'custom_event',
  pathname: '/app/launch',
  event_name: 'app_launch',
  properties: JSON.stringify({
    platform: 'ios',
    version: '1.2.3'
  })
});

// Track feature usage
trackEvent({
  type: 'custom_event',
  pathname: '/app/feature/camera',
  event_name: 'camera_used',
  properties: JSON.stringify({
    filter_applied: 'vintage'
  })
});
```